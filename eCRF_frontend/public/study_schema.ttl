@prefix dlschemas: <https://concepts.datalad.org/s/> .
@prefix dlthings: <https://concepts.datalad.org/s/things/unreleased/> .
@prefix dlidentifiers: <https://concepts.datalad.org/s/identifiers/unreleased/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix sio: <http://semanticscience.org/resource/> .
@prefix ex: <http://example.org/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

#########################################################
# Study Shape
#########################################################

dlschemas:StudyShape a sh:NodeShape ;
    sh:targetClass dlschemas:Study ;
    sh:closed true ;
    sh:description "A clinical or research study with a persistent identifier and optional metadata." ;

    # Required persistent identifier (PID)
    sh:property [
        sh:path dlthings:id ;
        sh:datatype xsd:anyURI ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:description "Persistent identifier (PID) for the study."
    ] ;

    # Optional additional identifiers (as blank nodes or IRIs conforming to an Identifier shape)
    sh:property [
        sh:path dlschemas:identifiers ;
        sh:nodeKind sh:BlankNodeOrIRI ;
        sh:minCount 0 ;
        sh:description "Optional additional identifiers for the study."
    ] ;

    # Study title (mapped to dcterms:title)
    sh:property [
        sh:path dcterms:title ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Title of the study."
    ] ;

    # Short name or acronym
    sh:property [
        sh:path ex:short_name ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Short name or acronym of the study."
    ] ;

    # Description or abstract
    sh:property [
        sh:path dcterms:description ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "A description or abstract of the study."
    ] ;

    # Study type
    sh:property [
        sh:path dcterms:type ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Type or category of the study (e.g. interventional, observational)."
    ] ;

    # Status (e.g. planning, ongoing, completed)
    sh:property [
        sh:path ex:status ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Current status of the study."
    ] ;

    # Principal Investigator (using dcterms:creator)
    sh:property [
        sh:path dcterms:creator ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Principal investigator (PI) of the study."
    ] ;

    # Sponsor (using dcterms:publisher as a proxy)
    sh:property [
        sh:path dcterms:publisher ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Sponsoring or funding organization of the study."
    ] ;

    # Study start date
    sh:property [
        sh:path prov:startedAtTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:description "Start date/time of the study."
    ] ;

    # Study end date
    sh:property [
        sh:path prov:endedAtTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:description "End date/time of the study."
    ] ;

    # Keywords (using dcat:keyword; multivalued)
    sh:property [
        sh:path dcat:keyword ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Keywords associated with the study."
    ] ;

    # Locations (using dcterms:spatial)
    sh:property [
        sh:path dcterms:spatial ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Geographic or site locations relevant to the study."
    ] ;

    # Participants relation (references to Participant resources)
    sh:property [
        sh:path dlschemas:participants ;
        sh:nodeKind sh:IRI ;
        sh:minCount 0 ;
        sh:description "References to participant entities in the study."
    ] .

#########################################################
# Participant Shape
#########################################################

dlschemas:ParticipantShape a sh:NodeShape ;
    sh:targetClass dlschemas:Participant ;
    sh:closed true ;
    sh:description "A participant (subject) in a study with a persistent identifier and optional demographic and enrollment metadata." ;

    # Required persistent identifier (PID)
    sh:property [
        sh:path dlthings:id ;
        sh:datatype xsd:anyURI ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:description "Persistent identifier (PID) for the participant."
    ] ;

    # Optional additional identifiers
    sh:property [
        sh:path dlschemas:identifiers ;
        sh:nodeKind sh:BlankNodeOrIRI ;
        sh:minCount 0 ;
        sh:description "Optional additional identifiers for the participant."
    ] ;

    # Link to the Study this participant belongs to
    sh:property [
        sh:path dcterms:isPartOf ;
        sh:nodeKind sh:IRI ;
        sh:minCount 0 ;
        sh:description "Reference to the study the participant is enrolled in."
    ] ;

    # Sex of the participant
    sh:property [
        sh:path ex:sex ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Sex or gender of the participant."
    ] ;

    # Age of the participant
    sh:property [
        sh:path ex:age ;
        sh:datatype xsd:integer ;
        sh:minCount 0 ;
        sh:description "Age of the participant."
    ] ;

    # Ethnicity of the participant
    sh:property [
        sh:path ex:ethnicity ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Ethnicity or race of the participant."
    ] ;

    # Enrollment date (using dcterms:date as a generic date property)
    sh:property [
        sh:path dcterms:date ;
        sh:datatype xsd:date ;
        sh:minCount 0 ;
        sh:description "Enrollment date of the participant."
    ] ;

    # Consent flag
    sh:property [
        sh:path ex:consentGiven ;
        sh:datatype xsd:boolean ;
        sh:minCount 0 ;
        sh:description "Indicates whether the participant has provided consent."
    ] ;

    # Consent date
    sh:property [
        sh:path ex:consentDate ;
        sh:datatype xsd:date ;
        sh:minCount 0 ;
        sh:description "Date when the participant provided consent."
    ] ;

    # Participant status (e.g. enrolled, withdrawn)
    sh:property [
        sh:path ex:participantStatus ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Current status of the participant."
    ] ;

    # Assigned study arm or group
    sh:property [
        sh:path ex:assignedArm ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Study arm or group assignment of the participant."
    ] ;

    # Enrollment site
    sh:property [
        sh:path ex:site ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:description "Site or center where the participant was enrolled."
    ] .
